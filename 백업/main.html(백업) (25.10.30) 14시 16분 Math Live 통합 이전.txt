<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì±„ì  í˜ì´ì§€</title>
  <link rel="stylesheet" href="style.css" />
  <style>
/* ====== ê° ë¬¸í•­ í•œ ì¤„ ë ˆì´ì•„ì›ƒ ====== */
.question-line {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 8px;
  flex-wrap: wrap;
}

/* ğŸ“± ëª¨ë°”ì¼ ëŒ€ì‘ */
@media (max-width: 600px) {
  .question-line {
    flex-direction: column;
    align-items: flex-start;
  }
}

/* ====== ì¹´ë“œ ì „ì²´ ====== */
.question-card {
  background: #f8f9ff;
  border: 1px solid #dde2f2;
  border-radius: 10px;
  padding: 10px 14px;
  margin-bottom: 10px;
  transition: background 0.3s ease, border-color 0.3s ease;
}
.question-card.graded {
  background: #f1f1f1;
  border-color: #ccc;
}

/* ====== ë¬¸í•­ë²ˆí˜¸ ====== */
.question-card h3 {
  margin: 0;
  font-size: 16px;
  color: #2a5adf;
  font-weight: 600;
  text-align: right;
  width: 60px;
  flex-shrink: 0;
}

/* ====== ì…ë ¥ì¹¸ (ë‹¨ë‹µí˜• / ì£¼ê´€ì‹) ====== */
.answer-input {
  flex: 1 1 60%;
  max-width: 60%;
  padding: 8px 10px;
  font-size: 15px;
  border: 1px solid #ccc;
  border-radius: 6px;
  height: 40px;
  box-sizing: border-box;
}
.answer-input:disabled {
  background: #eee;
  color: #777;
}

/* ====== ê°ê´€ì‹ ì„ íƒì§€ ====== */
.choices {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex: 1 1 60%;
  max-width: 60%;
  height: 40px;
  gap: 5px;
}
.choices label:hover {
  background: #dce8ff;
}
/* ì„ íƒ ì‹œ(checked) */
.choices input:checked + label {
  background: #2a5adf;
  color: white;
  font-weight: 600;
  box-shadow: inset 0 0 0 2px #173aaf;
  transition: background 0.2s ease, color 0.2s ease;
}
/* ë¹„í™œì„±í™” ìƒíƒœ */
.choices input:disabled + label {
  opacity: 0.6;
  cursor: not-allowed;
  background: #d9d9d9;
  color: #020202;
}

/* ====== ì±„ì  ë²„íŠ¼ ====== */
.check-btn {
  background: #2a5adf;
  color: white;
  border: none;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  font-size: 15px;
  text-align: center;
  transition: all 0.25s ease;
  margin-left: 20px;
  margin-right: 5%;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.check-btn:hover:not(.correct):not(.wrong):not(:disabled) {
  background: #173aaf;
}
.check-btn.correct {
  background: #e4f9ec;
  color: #0b7a32;
  border: 1.5px solid #1a8f4c;
}
.check-btn.wrong {
  background: #ffe9e9;
  color: #c81c1c;
  border: 1.5px solid #d93025;
}
.check-btn:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

/* ====== ì±„ì  ê²°ê³¼ ====== */
.result-inline {
  font-weight: bold;
  white-space: nowrap;
  min-width: 100px;
  text-align: right;
  flex: 0 0 auto;
  margin-right: 5%;
}
.correct { color: #1a8f4c; }
.wrong { color: #d93025; }

/* ====== í•˜ë‹¨ ë²„íŠ¼ ====== */
/* âœ… ìª½ ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.back-btn {
  background-color: #3cb371;     /* ê¸°ë³¸ ì´ˆë¡ (mediumseagreen) */
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 8px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.25s ease;
  box-shadow: 0 3px 6px rgba(0,0,0,0.1);
}

.back-btn:hover {
  background-color: #2e8b57;     /* hover ì‹œ ì§„í•œ ì´ˆë¡ */
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.back-btn:active {
  transform: translateY(0);
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.bottom-buttons {
  text-align: center;
  margin-top: 25px;
}
#check-all {
  background: #444;
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 8px;
  font-size: 15px;
  cursor: pointer;
  transition: background-color 0.2s;
}
#check-all:hover {
  background: #222;
}
  </style>
</head>
<body>
  <div class="container">
    <h1 id="page-title">ğŸ“˜ ì±„ì  í˜ì´ì§€</h1>
    <div id="question-container">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>

    <div class="bottom-buttons">
      <button id="check-all">ğŸ§® ëª¨ë‘ ì±„ì </button>
      <br />
      <button onclick="window.location.href='index.html'" class="back-btn" style="margin-top:15px;">
  â¬… ìª½ ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°
</button>
    </div>
  </div>

  <script>
  const API_URL = "https://script.google.com/macros/s/AKfycbwvdVkZm4EVUVeHaelSzQPrtFmOA2bB3A7HFMHEIbb42SbDFfNusYrsLyFbNakLmlMzcQ/exec";

  function getPageParam() {
    const params = new URLSearchParams(window.location.search);
    return params.get("page");
  }

  document.addEventListener("DOMContentLoaded", async () => {
    const page = getPageParam();
    const title = document.getElementById("page-title");
    const container = document.getElementById("question-container");

    if (!page) {
      container.innerHTML = "<p>âŒ ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.</p>";
      return;
    }

    title.textContent = `ğŸ“˜ ${page}ìª½ ì±„ì `;

    try {
      const res = await fetch(API_URL);
      const data = await res.json();

      const filtered = Object.entries(data)
        .filter(([_, q]) => q.page == page)
        .map(([id, q]) => ({ id, ...q }));

      if (filtered.length === 0) {
        container.innerHTML = "<p>âŒ í•´ë‹¹ ìª½ì˜ ë¬¸í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
        return;
      }

      container.innerHTML = filtered.map(q => {
        const type = q.type?.trim() || "";
        let inputHTML = "";
        let disabledAttr = "";
        let disabledMsg = "";

        if (type === "ê°ê´€ì‹") {
          const options = ["â‘ ", "â‘¡", "â‘¢", "â‘£", "â‘¤"];
          inputHTML = `
            <div class="choices">
              ${options.map(opt =>
                `<label><input type="radio" name="${q.id}" value="${opt}">${opt}</label>`
              ).join("")}
            </div>`;
        } 
        else if (type === "ê°ê´€ì‹(ë³µìˆ˜í˜•)") {
          const options = ["â‘ ", "â‘¡", "â‘¢", "â‘£", "â‘¤"];
          inputHTML = `
            <div class="choices">
              ${options.map(opt =>
                `<label><input type="checkbox" name="${q.id}" value="${opt}">${opt}</label>`
              ).join("")}
            </div>`;
        } 
        else if (type === "ë‹¨ë‹µí˜•(ì •ìˆ˜)") {
          inputHTML = `<input type="number" class="answer-input" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" />`;
        } 
        else if (type === "ë‹¨ë‹µí˜•(í•œê¸€ë¬¸ì)") {
          inputHTML = `<input type="text" class="answer-input" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”. ì˜ˆ) ã„±, ã„´ (ë„ì–´ì“°ê¸° ìƒê´€ ì—†ìŒ)" />`;
        } 
        else if (type === "ë‹¨ë‹µí˜•(ë¬¸ììˆ˜ì‹)") {
          inputHTML = `<input type="text" class="answer-input" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”. ì˜ˆ) âˆš2, ë£¨íŠ¸2, root2" />`;
        } 
        else if (type === "ë‹¨ë‹µí˜•" || type === "ì£¼ê´€ì‹") {
          inputHTML = `<input type="text" class="answer-input" value="í˜„ì¬ ë²„ì „ì—ì„œëŠ” ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤" disabled style="color:#d93025; font-weight:600;" />`;
          disabledAttr = "disabled";
          disabledMsg = "data-disabled='true'";
        } 
        else if (type === "ì„œìˆ í˜•") {
          inputHTML = `<p style="color:gray;">ğŸ“ ì„œìˆ í˜•ì€ ìë™ì±„ì  ëŒ€ìƒì´ ì•„ë‹™ë‹ˆë‹¤.</p>`;
          disabledAttr = "disabled";
          disabledMsg = "data-disabled='true'";
        }

        return `
          <div class="question-card" data-id="${q.id}">
            <div class="question-line">
              <h3>${q.id.replace("q","")}ë²ˆ</h3>
              ${inputHTML}
              ${type !== "ì„œìˆ í˜•" ? `<button class="check-btn" ${disabledAttr} ${disabledMsg}>ì±„ì </button>` : ""}
              <span class="result-inline"></span>
            </div>
            <input type="hidden" class="correct-answer" value="${q.ans}" />
            <input type="hidden" class="answer-type" value="${type}" />
          </div>
        `;
      }).join("");

      // âœ… ì±„ì  í•¨ìˆ˜
      function gradeQuestion(card) {
        const btn = card.querySelector(".check-btn");
        const result = card.querySelector(".result-inline");
        const correct = card.querySelector(".correct-answer").value.trim();
        const type = card.querySelector(".answer-type").value.trim();
        let userAns = "";

        if (btn.hasAttribute("data-disabled")) return false;

        btn.classList.remove("correct", "wrong");
        btn.textContent = "ì±„ì ";

        // ë‹¨ì¼ ê°ê´€ì‹
        if (type === "ê°ê´€ì‹") {
          const radios = card.querySelectorAll("input[type='radio']");
          const checked = [...radios].find(r => r.checked);
          userAns = checked ? checked.value.trim() : "";

          if (!userAns) {
            result.textContent = "âš ï¸ ì…ë ¥ ì—†ìŒ";
            result.className = "result-inline wrong";
            btn.classList.add("wrong");
            btn.textContent = "X";
            return false;
          }

          const correctAnswers = correct.split(/[, ]+/).map(v => v.trim()).filter(v => v);
          if (correctAnswers.includes(userAns)) {
            result.textContent = "âœ… ì •ë‹µ!";
            result.className = "result-inline correct";
            btn.classList.add("correct");
            btn.textContent = "O";
          } else {
            result.textContent = "âŒ ì˜¤ë‹µ..";
            result.className = "result-inline wrong";
            btn.classList.add("wrong");
            btn.textContent = "X";
          }

          [...radios].forEach(r => (r.disabled = true));
        }

        // ë³µìˆ˜í˜• ê°ê´€ì‹
        else if (type === "ê°ê´€ì‹(ë³µìˆ˜í˜•)") {
          const checkboxes = card.querySelectorAll("input[type='checkbox']");
          const selected = [...checkboxes].filter(c => c.checked).map(c => c.value.trim()).sort().join(",");
          const correctSet = correct.split(/[, ]+/).map(v => v.trim()).filter(v => v).sort().join(",");

          if (!selected) {
            result.textContent = "âš ï¸ ì…ë ¥ ì—†ìŒ";
            result.className = "result-inline wrong";
            btn.classList.add("wrong");
            btn.textContent = "X";
            return false;
          }

          if (selected === correctSet) {
            result.textContent = "âœ… ì •ë‹µ!";
            result.className = "result-inline correct";
            btn.classList.add("correct");
            btn.textContent = "O";
          } else {
            result.textContent = "âŒ ì˜¤ë‹µ..";
            result.className = "result-inline wrong";
            btn.classList.add("wrong");
            btn.textContent = "X";
          }

          [...checkboxes].forEach(c => (c.disabled = true));
        }

        // ë‹¨ë‹µí˜•(ì •ìˆ˜)
        else if (type === "ë‹¨ë‹µí˜•(ì •ìˆ˜)") {
          const input = card.querySelector(".answer-input");
          userAns = input.value.trim();

          if (!userAns) {
            result.textContent = "âš ï¸ ì…ë ¥ ì—†ìŒ";
            result.className = "result-inline wrong";
            btn.classList.add("wrong");
            btn.textContent = "X";
            return false;
          }

          if (Number(userAns) === Number(correct)) {
            result.textContent = "âœ… ì •ë‹µ!";
            result.className = "result-inline correct";
            btn.classList.add("correct");
            btn.textContent = "O";
          } else {
            result.textContent = "âŒ ì˜¤ë‹µ..";
            result.className = "result-inline wrong";
            btn.classList.add("wrong");
            btn.textContent = "X";
          }

          input.disabled = true;
        }

        // ë‹¨ë‹µí˜•(í•œê¸€ë¬¸ì)
        else if (type === "ë‹¨ë‹µí˜•(í•œê¸€ë¬¸ì)") {
          const input = card.querySelector(".answer-input");
          userAns = input.value.trim();

          if (!userAns) {
            result.textContent = "âš ï¸ ì…ë ¥ ì—†ìŒ";
            result.className = "result-inline wrong";
            btn.classList.add("wrong");
            btn.textContent = "X";
            return false;
          }

          if (userAns.replace(/\s+/g, "").toLowerCase() === correct.replace(/\s+/g, "").toLowerCase()) {
            result.textContent = "âœ… ì •ë‹µ!";
            result.className = "result-inline correct";
            btn.classList.add("correct");
            btn.textContent = "O";
          } else {
            result.textContent = "âŒ ì˜¤ë‹µ..";
            result.className = "result-inline wrong";
            btn.classList.add("wrong");
            btn.textContent = "X";
          }

          input.disabled = true;
        }

        // ë‹¨ë‹µí˜•(ë¬¸ììˆ˜ì‹)
        else if (type === "ë‹¨ë‹µí˜•(ë¬¸ììˆ˜ì‹)") {
          const input = card.querySelector(".answer-input");
          userAns = input.value.trim();

          const normalize = str =>
            str.replace(/root/gi, "âˆš")
               .replace(/ë£¨íŠ¸/g, "âˆš")
               .replace(/\s+/g, "")
               .trim();

          if (!userAns) {
            result.textContent = "âš ï¸ ì…ë ¥ ì—†ìŒ";
            result.className = "result-inline wrong";
            btn.classList.add("wrong");
            btn.textContent = "X";
            return false;
          }

          if (normalize(userAns) === normalize(correct)) {
            result.textContent = "âœ… ì •ë‹µ!";
            result.className = "result-inline correct";
            btn.classList.add("correct");
            btn.textContent = "O";
          } else {
            result.textContent = "âŒ ì˜¤ë‹µ..";
            result.className = "result-inline wrong";
            btn.classList.add("wrong");
            btn.textContent = "X";
          }

          input.disabled = true;
        }

        btn.disabled = true;
        card.classList.add("graded");
        return true;
      }

      // ê°œë³„ ì±„ì  ë²„íŠ¼
      document.querySelectorAll(".check-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const card = btn.closest(".question-card");
          gradeQuestion(card);
        });
      });

      // ëª¨ë‘ ì±„ì  ë²„íŠ¼
      document.getElementById("check-all").addEventListener("click", () => {
        const allCards = document.querySelectorAll(".question-card");
        allCards.forEach(card => {
          const btn = card.querySelector(".check-btn");
          if (btn && !btn.disabled) gradeQuestion(card);
        });
      });

    } catch (err) {
      console.error(err);
      container.innerHTML = "<p style='color:red;'>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>";
    }
  });
</script>


</body>
</html>
